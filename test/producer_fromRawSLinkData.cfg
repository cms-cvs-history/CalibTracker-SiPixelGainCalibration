process PIXELGAINCALIB = 
{
######################################################
#
#   By Freya Blekman
#
######################################################
# to change files change the following parameters:
# 1. the input file (PixelSLinkDataInputSource.fileNames parameter)
# 2. the calib database tag
# the following wiki page has lists of datasets: 
# https://twiki.cern.ch/twiki/bin/view/CMS/TIF_and_PSI_data
######################################################

######################################################
#  define the number of events to run on (-1 = all)
######################################################

   untracked PSet maxEvents = {untracked int32 input = 5200}

######################################################
#  Read settings from the calibration database 
######################################################

   include "CondCore/DBCommon/data/CondDBCommon.cfi"
# name of the database 
   replace CondDBCommon.connect = "sqlite_file:myDb.db"
   replace CondDBCommon.timetype = "runnumber"
   replace CondDBCommon.DBParameters.messageLevel = 0
   replace CondDBCommon.DBParameters.authenticationPath="."
   es_source = PoolDBESSource {
	using CondDBCommon
	VPSet toGet = { { 
			string record = "SiPixelCalibConfigurationRcd"
			# change the tag appropriately. Look at /afs/cern.ch/cms/Tracker/Pixel/configuration/TestDatabase.txt for existing tag names.
			string tag = "HC-Z1_HD1_B01_02_03_Gain_23Aug07_1851"
			} }
   }

#############################################
# Input source
#############################################

   include "IORawData/SiPixelInputSources/data/PixelSLinkDataInputSource.cfi"

#############################################
#   definition of the input file that contains the raw data
#   see https://twiki.cern.ch/twiki/bin/view/CMS/TIF_and_PSI_data 
#   for location of files
#############################################
   replace PixelSLinkDataInputSource.fileNames={'rfio:/castor/cern.ch/cms/store/TAC/PIXEL/FPIX/HC-Z1/HD1/Blades01_02_03/GainCalibration.23Aug07_1851.dmp'}

   include "CalibTracker/SiPixelGainCalibration/data/SiPixelCalibDigiProducer.cfi"


############################################################
#  this variable defines the name of the output root file...
############################################################

  module outputdigi = PoolOutputModule {
    untracked string fileName = 'calibdigis.root'
    # for now, keep all information...
 #   untracked vstring outputCommands = { "keep *"}
  }


############################################################
# uncomment these if you want to do timing studies...
############################################################

#    service = Timing {}

###########################do not edit unless you're an expert #############################################
#  all other stuff needed....
	
   # Message Logger
#   include "FWCore/MessageLogger/data/MessageLogger.cfi"
#   or use your own 
   service = MessageLogger {	
	untracked vstring destinations = {"cout"}
	untracked PSet FwkReport  = { untracked int32 reportEvery = 20 }
	untracked PSet cout = {untracked string threshold = "ERROR"}
	untracked PSet default = {untracked int32 limit = 10} # surpresses error messages in case of corrupt data files used as input for RawToDigi conversion
   }

   # module execution
   path p = { siPixelDigis, SiPixelCalibDigiProducer }
   endpath e = {outputdigi }
}
