process PIXELGAINCALIB = 
{
######################################################
# to change files change the following parameters:
# 1. the input file (PixelSLinkDataInputSource.fileNames parameter)
# 2. the calib.dat file location (SiPixelGainCalibrationAnalysis.inputFileName parameter)
# the following wiki page has lists of datasets: 
# https://twiki.cern.ch/twiki/bin/view/CMS/TIF_and_PSI_data
######################################################

   untracked PSet maxEvents = {untracked int32 input = -1}
   source = PoolSource { 
	untracked vstring fileNames = { "rfio:/castor/cern.ch/user/f/fblekman/pix_data/GainCalibrations/Digis/GainCalibration20070514b_digi.root" }
   }     


#use the settings for the calibration database access from the CondTools package
   include "CondTools/SiPixel/data/SiPixelGainCalibrationService.cfi"
   replace SiPixelGainCalibrationServiceParameters.UseCalibDataFromDB = false



  service = TFileService {    string fileName = "histogramsGainCalibration_fromDigi.root" }

   # Message Logger
#   include "FWCore/MessageLogger/data/MessageLogger.cfi"
#   or use your own 
   service = MessageLogger {	
	untracked vstring destinations = {"cout"}
	untracked PSet cout = {untracked string threshold = "ERROR"}
   }

   include "CalibTracker/SiPixelGainCalibration/data/SiPixelGainCalibrationAnalysis.cfi"
   replace SiPixelGainCalibrationAnalysis.inputFileName= "/afs/cern.ch/user/f/fblekman/public/calib_20070514b.dat"
   replace SiPixelGainCalibrationAnalysis.src = "siPixelDigis"

 	
######################### include all necessary files #########################
# only edit when you know what you're doing!!!

include "CalibTracker/SiPixelGainCalibration/data/fromDigi.cff" 
	

# the database output
  service = PoolDBOutputService {
    string timetype = "runnumber"
    string connect = "sqlite_file:prova_gaincalib_fromdigi.db"
    untracked string catalog = "xmlcatalog_file:prova_dbcatalog_gaincalib_fromdigi.xml"
    VPSet toPut={ {string record= "SiPixelGainCalibrationRcd" string tag ="mytest_p"} } 
    PSet DBParameters = { 
	untracked string authenticationPath = "./"  
	untracked int32 messageLevel = 1
	untracked bool loadBlobStreamer = true
	}
  }

   # module execution
   path p = { SiPixelGainCalibrationAnalysis }
}
