process AnalyzeGainFF = {

######################################################
#
#   By Freya Blekman
#
######################################################
# to change files change the following parameters:
# 1. the input file 
# 2. the calib database tag
# the following wiki page has lists of datasets: 
# https://twiki.cern.ch/twiki/bin/view/CMS/TIF_and_PSI_data
######################################################

######################################################
#  define the number of events to run on (-1 = all)
######################################################

   untracked PSet maxEvents = {untracked int32 input = -1}

############################################################
# define input file
############################################################
       
    source = PoolSource 
    { 
	# replace 'myfile.root' with the source file you want to use
	untracked vstring fileNames = {"file:calibdigis.root"}
    }

############################################################
# cabling maps and geometry
############################################################
       
    # Pixel Cabling Map from DataBase
    include "CalibTracker/Configuration/data/SiPixel_TIFCabling.cff"
    include "Geometry/TrackerSimData/data/trackerSimGeometryXML.cfi"
    include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
    include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
  
############################################################
# include the calibration database
############################################################
       
    # name of the database 
    include "CondTools/SiPixel/data/SiPixelGainCalibrationService.cfi"   
 
    include "CondCore/DBCommon/data/CondDBCommon.cfi"
    replace CondDBCommon.connect = "sqlite_file:myDb.db"
    replace CondDBCommon.timetype = "runnumber"
    replace CondDBCommon.DBParameters.messageLevel = 0
    replace CondDBCommon.DBParameters.authenticationPath="."
    es_source = PoolDBESSource {
	using CondDBCommon
	VPSet toGet = { { 
		string record = "SiPixelCalibConfigurationRcd"
		# change the tag appropriately. Look at /afs/cern.ch/cms/Tracker/Pixel/configuration/TestDatabase.txt for existing tag names.
		string tag = "HC-Z1_HD1_B01_02_03_Gain_23Aug07_1851"
	    } }
    }

############################################################
# include DQM services
############################################################
 
service = DaqMonitorROOTBackEnd{}

############################################################
# include the settings for sipixelgaincalibrationanalysis.cfi
############################################################
 
    include "CalibTracker/SiPixelGainCalibration/data/SiPixelGainCalibrationAnalysis.cfi"
    replace siPixelGainCalibrationAnalysis.outputFileName="test_ffgain.root"
    replace siPixelGainCalibrationAnalysis.DetSetVectorSiPixelCalibDigiTag=SiPixelCalibDigiProducer

############################################################
# include the message logger
############################################################
 
    include "FWCore/MessageService/data/MessageLogger.cfi"
    replace MessageLogger.cout =  {      
	untracked string threshold = "INFO"    
	#   untracked PSet default = { untracked int32 limit = 10000000 }  
	untracked PSet FwkReport =  { 
	    untracked int32 limit = 100000 
	    untracked int32 reportEvery = 2000 
	}
	untracked PSet Root_Information = { untracked int32 limit = 0 }
    }

# the database output
  service = PoolDBOutputService {
    string timetype = "runnumber"
    string connect = "sqlite_file:prova_rawdata.db"
    VPSet toPut={ {string record= "SiPixelGainCalibrationRcd" string tag ="GainCalib_v2_test"} }   
    PSet DBParameters = { 
	untracked string authenticationPath = "./"  
	untracked int32 messageLevel = 1
     	}
  }


############################################################
# uncomment these if you want to do timing studies...
############################################################

#    service = Timing {}

module contentdump  = EventContentAnalyzer{}


############################################################
# define the various paths
############################################################
 
    path p = {siPixelGainCalibrationAnalysis} 
    endpath ep = {contentdump}
}
